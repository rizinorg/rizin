function toggle_minimap(){r2ui._dis.minimap?(r2ui._dis.minimap=!1,r2ui.seek(r2ui._dis.selected_offset,!1),$("#minimap").hide()):(r2ui._dis.minimap=!0,r2ui.seek(r2ui._dis.selected_offset,!1),$("#minimap").show())}function update_minimap(){if(r2ui._dis.minimap&&$("#canvas svg").length){var e=200,r=200,t=$("#canvas svg")[0].getBBox().width,n=$("#canvas svg")[0].getBBox().height,i=Math.ceil(t/e),o=Math.ceil(n/r),a=1/Math.max(i,o),s=0;o>i&&(s=e/2-t*a/2);var c=null;$("#radareApp_mp").length?c=$("#main_panel"):$("#main_panel").length&&(c=$("#center_panel")),c.scrollTop()<n&&($("#minimap_area").width(c.width()*a),$("#minimap_area").height(c.height()*a),c.scrollTop()*a<=r-c.height()*a&&$("#minimap_area").css("top",c.scrollTop()*a),$("#minimap_area").css("left",s+c.scrollLeft()*a)),c=$("#center_panel"),$("#radareApp_mp").length?($("#minimap").css("display","none"),$("#minimap").css("left",c.scrollLeft()+c.width()-e-$("#radareApp_mp").position().left+2*c.css("padding").replace("px","")),$("#minimap").css("top",c.scrollTop()),$("#minimap").css("display","block")):$("#main_panel").length&&($("#minimap").css("left",c.scrollLeft()+$("#main_panel").width()-e),$("#minimap").css("top",c.scrollTop())),$("#minimap").css("border","1px solid "+r2ui.colors[".ec_gui_background"]),$("#minimap_area").css("background",r2ui.colors[".ec_gui_background"])}}function reposition_graph(){var e=r2ui.graph.getElements(),r=r2ui.get_fcn_BBs(r2ui.current_fcn_offset),t=Object.keys(r);for(var n in e){found=!1;for(var i in t){var o=String(t[i]),a=r[o];if(e[n].prop("id")===o){found=!0,"null"!==a.x&&"null"!==a.y&&e[n].translate(a.x-e[n].prop("position").x,a.y-e[n].prop("position").y);var s=a.color;null!==s&&void 0!==s&&e[n].attr("rect/fill",s)}}}}function render_graph(e){var r;try{r=JSON.parse(e.replace(/\\l/g,"\\n"))}catch(e){console.log("Cannot parse JSON data")}if(void 0===r[0])return!1;if(void 0===r[0].blocks)return!1;var t=new BBGraph;r2ui.current_fcn_offset=r[0].blocks[0].ops[0].offset;for(var n=0;n<r[0].blocks.length;n++){var i=r[0].blocks[n],o=i.offset;if(void 0!==i.trace){var a=r2ui.get_fcn_BB(r2ui.current_fcn_offset,o);void 0!==a?"red"!==a.color&&(a.color="#7592DF"):a={x:null,y:null,color:"#7592DF"},r2ui.update_fcn_BB(r2ui.current_fcn_offset,o,a)}if(0!==i.length){var s=i.ops.length,c="";for(var l in i.ops){var d=i.ops[l];void 0===d.comment||null===d.comment?d.comment="":d.comment=atob(d.comment),c+=html_for_instruction(d)}var f=document.createElement("div");f.id="bb_"+o,f.className="basicblock enyo-selectable ec_gui_background ec_gui_border",f.innerHTML=c,t.addVertex(o,s,f),i.fail>0?(t.addEdge(o,i.fail,"red"),i.jump>0&&t.addEdge(o,i.jump,"green")):i.jump>0&&t.addEdge(o,i.jump,"blue")}}t.render();var u=$("#canvas svg g .element");return u.on("mousedown",function(){flag=0}),u.on("mousemove",function(){flag=1}),u.on("mouseup",function(e){if(0===flag){var r=e.target.parentNode.parentNode.parentNode.getAttribute("model-id");if("minimap_area"!==r){var t=r2ui.get_fcn_BB(r2ui.current_fcn_offset,r);void 0!==t&&null!==t?"red"===t.color?t.color=r2ui.colors[".ec_gui_alt_background"]:t.color="red":t={x:"null",y:"null",color:"red"},r2ui.update_fcn_BB(r2ui.current_fcn_offset,r,t),reposition_graph()}}}),$(".addr").css("-webkit-user-select","text"),!0}function render_instructions(e){var r=document.createElement("div");r.id="outergbox";var t=document.getElementById("canvas");t.innerHTML="";var n=document.createElement("div");n.id="gbox",n.className="ec_gui_background",r.appendChild(n),t.appendChild(r);var i=getOffsetRect(t),o=r2.settings["asm.lines"],a=r2.settings["asm.offset"],s=i.top,c=[],l={},d=e[0].offset,f=e[e.length-1].offset;for(var u in e){var p=e[u];if(("jmp"==p.type||"cjmp"==p.type)&&void 0!==p.jump&&null!==p.jump){var m={};m.from=p.offset,f<p.jump?(m.to_end=!1,m.to=f):d>p.jump?(m.to_end=!1,m.to=d):(m.to_end=!0,m.to=p.jump),"jmp"==p.type?(m.color=r2ui.colors[".ec_flow"],m.dashed=!1):"cjmp"==p.type&&(m.color=r2ui.colors[".ec_gui_cflow"],m.dashed=!0),m.to_start=!0,c[c.length]=m,void 0===l[m.to]&&(l[m.to]=0)}if(void 0===p.comment||null===p.comment)p.comment="";else try{p.comment=atob(p.comment)}catch(e){console.log(p.comment)}var _=document.createElement("div");o?_.className="instructionbox enyo-selectable lines":_.className="instructionbox",_.style.top=s+"px",_.innerHTML=html_for_instruction(p),n.appendChild(_);var g=getOffsetRect(_),h=g.bottom-g.top;s+=h}if(o){var v=document.createElement("canvas");v.width=500,v.height=s,v.id="linecanvas",v.setAttribute("tabindex","1"),v.setAttribute("style","outline: none;"),n.appendChild(v);var b=v.getContext("2d");b.setLineDash||(b.setLineDash=function(){});var y=countProperties(l),x=0,j=100;for(var k in c){var m=c[k],B="0x"+m.from.toString(16),w="0x"+m.to.toString(16);0===l[m.to]&&(l[m.to]=(y-x-1)*(90/(y+1)),x+=1);var S=get_element_by_address(B),T=get_element_by_address(w);if(null!==S&&void 0!==S&&void 0!==T&&null!==T){var M=l[m.to],O=getOffsetRect(S),R=(O.top+O.bottom)/2,C=getOffsetRect(T),z=(C.top+C.bottom)/2;m.to==e[0].offset&&(z=0),b.beginPath(),b.moveTo(M,R),b.lineTo(M,z),b.strokeStyle=m.color,m.dashed&&b.setLineDash([2,3]),b.stroke(),m.to_start&&(b.beginPath(),b.moveTo(M,R),b.lineTo(j-5,R),b.strokeStyle=m.color,m.dashed&&b.setLineDash([2,3]),b.stroke(),b.beginPath(),b.arc(j-5-2,R,2,0,2*Math.PI,!1),b.fillStyle=m.color,b.fill()),m.to_end&&(b.beginPath(),b.moveTo(M,z),b.lineTo(j-5,z),b.strokeStyle=m.color,m.dashed&&b.setLineDash([2,3]),b.stroke(),b.beginPath(),b.moveTo(j-5,z),b.lineTo(j-10,z-5),b.lineTo(j-10,z+5),b.lineWidth=1,b.fillStyle=m.color,b.fill())}}}if(!a){var E=document.getElementsByClassName("insaddr");for(var L in E)E[L].style&&(E[L].style.display="none")}$(".addr").css("-moz-user-select","text"),$(".addr").css("-webkit-user-select","text")}function getOffsetRect(e){var r=e.getBoundingClientRect(),t=$("#gbox").offset().top,n=r.top-t,i=r.bottom-t;return{top:Math.round(n),bottom:Math.round(i)}}function countProperties(e){var r=0;for(var t in e)e.hasOwnProperty(t)&&++r;return r}function toBoolean(e){return"true"===e||"false"!==e&&void 0}function html_for_instruction(e){var r='<div class="instruction enyo-selectable">',t="0x"+e.offset.toString(16),n=t,i=r2.settings["asm.flags"],o=r2.settings["asm.bytes"],a=r2.settings["asm.xrefs"],s=r2.settings["asm.cmt.right"];if(e.fcn_addr>0&&t==="0x"+e.fcn_addr.toString(16)){"flat"==r2ui._dis.display&&(r+='<div class="ec_flow">; -----------------------------------------------------------</div>');var c,l="afij "+t;r2.cmd(l,function(e){c=e.split("\n")});try{var d=JSON.parse(c[0]);null!==d&&void 0!==d&&d.length>0&&(r+='<div class="ec_fname">(fcn) '+d[0].name+"</div>")}catch(e){console.log("Error getting instruction information from afij command")}var f=[];l="afvrj "+t,r2.cmd(l,function(e){f=e.split("\n")});try{var u=JSON.parse(f[0]),p=[];for(var m in u)r+='<div class="ec_flag">; '+u[m].kind+" "+u[m].type+" <span class='fvar id_"+address_canonicalize(t)+"_"+u[m].ref+" ec_prompt faddr faddr_"+address_canonicalize(t)+"'>"+escapeHTML(u[m].name)+"</span> @ "+u[m].ref+"</div>",p[p.length]={name:u[m].name,id:address_canonicalize(t)+"_"+u[m].ref};r2.varMap[e.fcn_addr]=p}catch(e){console.log("Error getting variable information from afvj command")}var _=[],g=[],h=[];l="afvbj "+t,r2.cmd(l,function(e){g=e.split("\n")}),l="afvsj "+t,r2.cmd(l,function(e){h=e.split("\n")}),_=g.concat(h);try{var v=JSON.parse(_[0]),b=[];for(var m in v){var y="";if(null!==v[m].ref&&void 0!==v[m].ref){var x=v[m].ref.base,j=v[m].ref.offset,k=(v[m].ref.type,"+");j-0&&(ref_sig="-"),y=x+k+j}r+='<div class="ec_flag">; '+v[m].kind+" "+v[m].type+" <span class='farg id_"+address_canonicalize(t)+"_"+y+" ec_prompt faddr faddr_"+address_canonicalize(t)+"'>"+escapeHTML(v[m].name)+"</span> @ "+y+"</div>",b[b.length]={name:v[m].name,id:address_canonicalize(t)+"_"+v[m].ref}}r2.argMap[e.fcn_addr]=b}catch(e){console.log("Error getting argument information from afaj command")}}if(i){var $;$=void 0!==e.flags&&null!==e.flags?e.flags.join(";"):r2.get_flag_names(address_canonicalize(t)).join(";"),""!==$&&void 0!==$&&null!==$&&(r+='<div class="ec_flag flags_'+address_canonicalize(t)+'">;-- '+escapeHTML($)+":</div> ")}if(e.comment&&!s&&(r+='<div class="comment ec_comment comment_'+address_canonicalize(t)+'">; '+escapeHTML(e.comment)+"</div>"),a&&void 0!==e.xrefs&&null!==e.xrefs&&e.xrefs.length>0){for(var m in e.xrefs){var B=e.xrefs[m],w="",S="0x"+B.addr.toString(16);r2.get_flag_names(address_canonicalize(S)).length>0&&(w=" ("+r2.get_flag_names(address_canonicalize(S)).join(";")+")"),r+='<div class="ec_flag xrefs">; '+B.type.toUpperCase()+' XREF from <span class="offset addr addr_'+address_canonicalize(S)+'">'+S+"</span> "+w+"</div> "}}if(r+='<span class="insaddr datainstruction ec_offset addr addr_'+address_canonicalize(t)+'">'+n+"</span> ",o&&void 0!==e.bytes&&null!==e.bytes&&""!==e.bytes){var T=function(e){return"00"==e?'<span class="ec_b0x00">00</span>':"ff"==e?'<span class="ec_b0x00">ff</span>':"7f"==e?'<span class="ec_b0x00">7f</span>':void 0},M=e.bytes.replace(new RegExp("(00)|(ff)|(7f)","g"),T);r+='<span class="bytes ec_other">'+M+"</span> "}var O=highlight_instruction(e.opcode,!0);if(null!==r2.varMap[e.fcn_addr]&&void 0!==r2.varMap[e.fcn_addr]&&r2.varMap[e.fcn_addr].length>0||null!==r2.argMap[e.fcn_addr]&&void 0!==r2.argMap[e.fcn_addr]&&r2.argMap[e.fcn_addr].length>0){for(var m in r2.varMap[e.fcn_addr]){var R=r2.varMap[e.fcn_addr][m].name,C=r2.varMap[e.fcn_addr][m].id;O=O.replace(" "+R+" "," <span class='fvar id_"+C+" ec_prompt faddr faddr_"+address_canonicalize(t)+"'>"+escapeHTML(R)+"</span> ")}for(var m in r2.argMap[e.fcn_addr]){var z=r2.argMap[e.fcn_addr][m];r2.argMap[e.fcn_addr][m].id;O=O.replace(" "+z+" "," <span id='fvar id_"+C+" ec_prompt faddr faddr_"+address_canonicalize(t)+"'>"+escapeHTML(R)+"</span> ")}}return void 0!==e.type&&null!==e.type?(contains(math,e.type)&&(e.type="math"),contains(bin,e.type)&&(e.type="bin"),"ill"==e.type&&(e.type="invalid"),"null"==e.type&&(e.type="invalid"),"undefined"==e.type&&(e.type="invalid"),"ujmp"==e.type&&(e.type="jmp"),"upush"==e.type&&(e.type="push"),"upop"==e.type&&(e.type="pop"),"ucall"==e.type&&(e.type="call"),"lea"==e.type&&(e.type="mov"),contains(known_types,e.type)||(e.type="other"),r+='<div class="instructiondesc ec_'+e.type+'">'+O+"</div> "):r+='<div class="instructiondesc">'+O+"</div> ",e.ptr_info&&(r+='<span class="comment ec_comment comment_'+address_canonicalize(t)+'">'+escapeHTML(e.ptr_info)+"</span>"),e.comment&&s&&(r+='<span class="comment ec_comment comment_'+address_canonicalize(t)+'"> ; '+escapeHTML(e.comment)+"</span>"),"ret"==e.type&&(r+="<div>&nbsp</div>"),r+="</div>"}function highlight_instruction(e,r){function t(e){if("0x"!=e.substr(0,2))return o[e];var r=r2.get_flag_names(address_canonicalize(e));for(var t in r){if(r[t].indexOf("sym.imp."))return"<span class='ec_offset addr addr_"+address_canonicalize(e)+"'>"+r[t]+"</span>";if(r[t].indexOf("fcn."))return"<span class='ec_offset addr addr_"+address_canonicalize(e)+"'>"+r[t]+"</span>"}var n=get_data_type(e);return""===n?"<span class='ec_num'>"+e+"</span>":"datainstruction"===n?"<span class='ec_offset addr addr_"+address_canonicalize(e)+"'>"+e+"</span>":"datamemory"===n?"<span class='ec_dataoffset'>"+e+"</span>":void 0}if(void 0===e)return"undefined";void 0===r&&(r=!0);var n=escapeHTML(e),i="(0x[0123456789abcdef]+)",o={};if(r){for(var a in regs){var s='<span class="ec_reg">'+regs[a]+"</span>";o[regs[a]]=s,s='<span class="ec_reg">'+regs[a].toLowerCase()+"</span>",o[regs[a].toLowerCase()]=s}for(a in o)i+="|("+a+")"}return n.replace(new RegExp(i,"g"),t)}function hex2(e){if(void 0===e)return"__";var r=e.toString(16);return 1==r.length?"0"+r:r}function hex(e){return void 0===e?"":(e<0&&(e+=4294967296),"0x"+e.toString(16))}function get_data_type(e,r){var t=r2.get_address_type(e);return""===t?"":void 0!==r?"data"+t+" addr addr_"+e:"data"+t}function fnum(e){return parseInt(e,10)}function get_address_from_class(e,r){void 0===r&&(r="addr");var t=r+"_";if(e){var n=e.className.split(" ").filter(function(e){return e.substr(0,t.length)==r+"_"});if(1==n.length)return n[0].split("_")[1].split(" ")[0]}}function rehighlight_iaddress(e,r){void 0===r&&(r="addr"),$(".autohighlighti").removeClass("autohighlighti"),$("."+r+"_"+e).addClass("autohighlighti"),"addr"===r&&r2.cmd("s "+e,function(){})}function rehighlight_id(e){$(".autohighlighti").removeClass("autohighlighti"),$("#"+e).addClass("autohighlighti")}function get_element_by_address(e){var r=$(".insaddr.addr_"+e);return 1===r.length?r[0]:null}function scroll_to_address(e){var r=$(".insaddr.addr_"+e);if(null!==r[0]&&void 0!==r[0]){var t=r[0].documentOffsetTop()-window.innerHeight/2;t=Math.max(0,t),$("#main_panel").scrollTo({top:t,left:0})}}function has_scrollbar(e){return e.scrollHeight>e.clientHeight}function on_scroll(e){if(!r2ui._dis.scrolling){var r=!!$("#radareApp").length,t=!1;if(r||(t=0===$("#main_panel").tabs("option","active")),r2ui._dis.scrolling=!0,"flat"==r2ui._dis.display&&(r||t)){var n=null,i=null,o=null;r?(n=$("#main_panel").scrollTop(),i=$("#gbox").height()-$("#main_panel").height()-10,container_element=$("#center_panel")):(n=$("#center_panel").scrollTop(),i=$("#gbox").height()-$("#center_panel").height()-10,container_element=$("#disasm_tab")),has_scrollbar($("#center_panel")[0])&&(0===n?(o="0x"+r2ui._dis.instructions[0].offset.toString(16),r2.get_disasm_before(o,50,function(e){r2ui._dis.instructions=e.concat(r2ui._dis.instructions)}),container_element.html("<div id='canvas' class='canvas enyo-selectable ec_gui_background'></div>"),render_instructions(r2ui._dis.instructions),scroll_to_address(o),rehighlight_iaddress(r2ui._dis.selected_offset)):n>i&&(o="0x"+r2ui._dis.instructions[r2ui._dis.instructions.length-1].offset.toString(16),r2.get_disasm_after(o,100,function(e){r2ui._dis.instructions=r2ui._dis.instructions.slice(0,-1).concat(e)}),container_element.html("<div id='canvas' class='canvas enyo-selectable ec_gui_background'></div>"),render_instructions(r2ui._dis.instructions),scroll_to_address(o),rehighlight_iaddress(r2ui._dis.selected_offset)))}r2ui._dis.scrolling=!1,e.preventDefault()}}function scroll_to_element(e){var r=e.documentOffsetTop()-window.innerHeight/2;r=Math.max(0,r),$("#main_panel").scrollTo({top:r,left:0})}function rename(e,r,t,n){if(void 0===n&&(n="functions"),"functions"==n&&r2.cmdj("pdfj @ "+e+"|",function(r){null!==r&&void 0!==r&&"0x"+r.addr.toString(16)===e&&r2.cmd("afn "+t+" "+e,function(){r2.update_flags()})}),""!==t&&""!==r){var i="fs "+n+";fr "+r+" "+t;r2.cmd(i,function(){})}else if(""===t&&""!==r){var i="fs "+n+";f-@"+e;r2.cmd(i,function(){})}else if(""!==t&&""===r){var i="fs "+n+";f "+t+" @ "+e;r2.cmd(i,function(){})}r2.update_flags()}function address_canonicalize(e){for(e=e.substr(2);"0"==e.substr(0,1);)e=e.substr(1);return e="0x"+e,e=e.toLowerCase()}function contains(e,r){for(var t=0;t<e.length;t++)if(e[t]===r)return!0;return!1}function handleInputTextChange(){r2ui._dis.handleInputTextChange()}function show_contextMenu(e,r){r2ui._dis.showContextMenu(e,r)}function get_offset_flag(e){var r="";return r2.cmdj("fs offsets;fj",function(t){for(var n in t)if("0x"+t[n].offset.toString(16)==e){r=t[n].name;break}}),r}function get_symbol_flag(e){var r=e,t=!1;return r2.cmdj("fs symbols;fj",function(n){for(var i in n)if(n[i].name==e){t=!0;break}if(!t)for(var i in n)if(n[i].name=="sym."+e){r="sym."+e;break}}),r}function get_reloc_flag(e){var r=e,t=!1;return r2.cmdj("fs relocs;fj",function(n){for(var i in n)if(n[i].name==e){t=!0;break}if(!t)for(var i in n)if(n[i].name=="reloc."+e){r="reloc."+e;break}}),r}function createCookie(e,r,t){if(t){var n=new Date;n.setTime(n.getTime()+24*t*60*60*1e3);var i="; expires="+n.toGMTString()}else var i="";document.cookie=e+"="+r+i+"; path=/"}function readCookie(e){for(var r=e+"=",t=document.cookie.split(";"),n=0;n<t.length;n++){for(var i=t[n];" "==i.charAt(0);)i=i.substring(1,i.length);if(0==i.indexOf(r))return i.substring(r.length,i.length)}return null}function eraseCookie(e){createCookie(e,"",-1)}function do_randomcolors(){r2.cmd("ecr;ec gui.background rgb:000",function(){r2ui.load_colors()})}function inColor(e){return"e scr.color=true;"+e+";e scr.color=false"}function isFirefoxOS(){return"undefined"!=typeof locationbar&&!locationbar.visible&&navigator.userAgent.indexOf("Firefox")>-1&&navigator.userAgent.indexOf("Mobile")>-1&&"mozApps"in navigator}function asyncLoop(e,r,t){var n=0,i=!1,o={next:function(){i||(n<e?(n++,r(o)):(i=!0,t()))},iteration:function(){return n-1},break:function(){i=!0,t()}};return o.next(),o}function dump(e){var r="";for(var t in e)r+=t+"\n";alert(r)}function objtostr(e){var r="";for(var t in e)r+=t+": "+e[t]+",\n";return r}function Ajax(e,r,t,n,i){if("undefined"==typeof XMLHttpRequest)return!1;if("fake"==r2.asyncMode)return n&&n("{}"),!0;if("sasync"==r2.asyncMode&&(console.log("async waiting"),ajax_in_process))return setTimeout(function(){Ajax(e,r,t,n)},100),!1;var o=void 0;if(isFirefoxOS())var o=new XMLHttpRequest({mozSystem:!0});else var o=new XMLHttpRequest;if(!o)return!1;ajax_in_process=!0,"sync"==r2.asyncMode?o.open(e,r,!1):o.open(e,r,!0),o.setRequestHeader("Accept","text/plain"),o.setRequestHeader("Content-Type","application/x-ww-form-urlencoded; charset=UTF-8"),o.onreadystatechange=function(){ajax_in_process=!1,200==o.status?n?n(o.responseText):console.error("missing ajax callback"):((i||r2.err)("connection refused"),console.error("ajax "+o.status))};try{o.send(t)}catch(e){"NetworkError"==e.name&&(i||r2.err)("connection error")}return!0}function _internal_cmd(e,r,t){return"undefined"!=typeof r2cmd&&(hascmd=r2cmd),hascmd?"undefined"!=typeof r2plugin?r(r2cmd(e)):hascmd(e,r):void Ajax("GET",r2.root+"/cmd/"+encodeURI(e),"",function(e){r&&r(e)},t)}var BBGraph=function(){this.vertices={},this.edges=[],this.elements=[],this.links=[],this.fcn_offset=0,joint.shapes.html={},joint.shapes.html.Element=joint.shapes.basic.Rect.extend({defaults:joint.util.deepSupplement({type:"html.Element",attrs:{rect:{stroke:r2ui.colors[".ec_gui_border"],fill:r2ui.colors[".ec_gui_alt_background"]}}},joint.shapes.basic.Rect.prototype.defaults)}),joint.shapes.html.ElementView=joint.dia.ElementView.extend({initialize:function(){_.bindAll(this,"updateBox"),joint.dia.ElementView.prototype.initialize.apply(this,arguments),this.$box=$(_.template(this.model.get("html"))()),this.$box.find("input").on("mousedown click",function(e){e.stopPropagation()}),this.model.on("change",this.updateBox,this),this.updateBox()},render:function(){return joint.dia.ElementView.prototype.render.apply(this,arguments),this.paper.$el.prepend(this.$box),this.updateBox(),this},updateBox:function(){var e=this.model.getBBox();this.$box.css({width:e.width+2,height:e.height-6,left:e.x-1,top:e.y+7})}})};BBGraph.prototype.addVertex=function(e,r,t){void 0===this.vertices[e]&&(this.vertices[e]={},this.vertices[e].parents=[],this.vertices[e].children=[],void 0===r&&void 0===t&&(this.vertices[e].len=1,t=document.createElement("div"),t.id="bb_"+e,t.className="basicblock enyo-selectable ec_gui_background ec_gui_border",t.innerHTML="<div class='instruction enyo-selectable'><span class='insaddr datainstruction ec_offset addr addr_0x"+e.toString(16)+"' >0x"+e.toString(16)+"</span></div>",this.vertices[e].rendered=t)),void 0!==r&&void 0!==t&&(this.vertices[e].len=r,this.vertices[e].rendered=t)},BBGraph.prototype.addEdge=function(e,r,t){this.addVertex(e),this.addVertex(r),this.edges.push({from:e,to:r,color:t}),this.vertices[e].children.push(r),this.vertices[r].parents.push(e)},BBGraph.prototype.makeElement=function(e,r,t,n){this.elements.push(new joint.shapes.html.Element({id:String(e),size:{width:r,height:t},html:n}))},BBGraph.prototype.makeLink=function(e,r,t){this.links.push(new joint.dia.Link({source:{id:String(e)},target:{id:String(r)},attrs:{".marker-target":{d:"M 6 0 L 0 3 L 6 6 z",fill:t,stroke:t},".connection":{"stroke-width":1,stroke:t},".link-tools":{display:"none"}},smooth:!0}))},adjustVertices=function(e,r){if(r=r.model||r,r instanceof joint.dia.Element)return void _.chain(e.getConnectedLinks(r)).groupBy(function(e){return _.omit([e.get("source").id,e.get("target").id],r.id)[0]}).each(function(r,t){"undefined"!==t&&adjustVertices(e,_.first(r))});var t=r.get("source").id||r.previous("source").id,n=r.get("target").id||r.previous("target").id,i=_.filter(e.getLinks(),function(e){var r=e.get("source").id,i=e.get("target").id;return r===t&&i===n||r===n&&i===t});if(i.length>1){var o=r2ui.graph.getCell(t).getBBox(),a=r2ui.graph.getCell(n).getBBox();src=o.intersectionWithLineFromCenterToPoint(a.center()),dst=a.intersectionWithLineFromCenterToPoint(o.center());var s=g.line(src,dst).midpoint(),c=src.theta(dst),l=10;_.each(i,function(e,r){var t=l,n=r%2?1:-1,i=g.toRad(c+90*n),d=g.point.fromPolar(t,i,s);o.containsPoint(d)||a.containsPoint(d)?e.unset("vertices"):e.set("vertices",[{x:d.x,y:d.y}])})}},BBGraph.prototype.render=function(){var e=Object.keys(this.vertices).toString(),r=document.createElement("div");r.id="outergbox";var t=document.getElementById("canvas"),n=document.createElement("div");n.id="gbox",n.className=e,r.appendChild(n),t.appendChild(r);for(var i in this.vertices){var o=this.vertices[i].rendered;void 0!==o&&(n.appendChild(o),this.makeElement(i,o.offsetWidth,o.offsetHeight,o.outerHTML))}for(var a=0;a<this.edges.length;a++)this.makeLink(this.edges[a].from,this.edges[a].to,this.edges[a].color);$("#outergbox").remove(),this.makeElement("minimap_area",1,1,"<div id='minimap_area'>");var s=this.elements.concat(this.links),c=($("#center_panel").width(),new joint.dia.Graph),l=new joint.dia.Paper({el:$("#canvas"),gridSize:1,width:2e3,height:6e3,model:c}),d=200,f=200;$("#minimap").html(""),$("#minimap").html("");var u=new joint.dia.Paper({el:$("#minimap"),gridSize:1,width:d,height:f,model:c});c.resetCells(s),joint.layout.DirectedGraph.layout(c),r2ui.graph=c,reposition_graph(),$("#minimap .basicblock").remove(),c.getCell("minimap_area").attr({rect:{stroke:"transparent"}});var p=$("#canvas svg")[0].getBBox().width,m=$("#canvas svg")[0].getBBox().height;l.setDimensions(p+500,m+500);var g=Math.ceil(p/d),h=Math.ceil(m/f),v=1/Math.max(g,h),b=0;h>g&&(b=d/2-p*v/2),u.scale(v),u.setOrigin(b,0),$("#radareApp_mp").length?($("#minimap").css("left",$("#main_panel").width()-d-$("#main_panel").position().left),$("#minimap").css("top",$("#center_panel").position().top),$("#main_panel").bind("scroll",update_minimap)):$("#main_panel").length&&($("#minimap").css("left",$("#main_panel").width()-d),$("#minimap").css("top",$("#center_panel").position().top-40),$("#center_panel").bind("scroll",update_minimap)),l.on("cell:pointerup",function(e){var r=e.model,t=r.attributes.position,n=String(r.prop("id"));if(void 0!==r&&"minimap_area"!==n){var i=r2ui.get_fcn_BB(r2ui.current_fcn_offset,n);void 0!==i&&null!==i?i.x==String(t.x)&&i.y==String(t.y)||(i.x=t.x,i.y=t.y,r2ui.update_fcn_BB(r2ui.current_fcn_offset,n,i)):void 0!==i&&null!==i&&r2ui.update_fcn_BB(r2ui.current_fcn_offset,n,{x:t.x,y:t.y})}});var y=_.partial(adjustVertices,c);_.each(c.getLinks(),y),l.on("cell:pointerup",y),r2ui._dis.minimap?(update_minimap(),$("#minimap_area").draggable({containment:"parent",stop:function(e,r){var t=r.position.left/v,n=r.position.top/v;t<0&&(t=0),n<0&&(n=0),$("#radareApp_mp").length?$("#main_panel").scrollTo({top:n,left:t-b/v}):$("#center_panel").scrollTo({top:n,left:t-b/v})}})):$("#minimap").hide()};var flag=0,math=["add","sub","mul","imul","div","idiv","neg","adc","sbb","inc","dec",".byte"],bin=["xor","and","or","not"],regs=["EAX","ECX","EDX","EBX","ESP","EBP","ESI","EDI","EIP","RAX","RCX","RDX","RBX","RSP","RBP","RSI","RDI","R0","R1","R2","R3","R4","R5","R6","R7","R8","R9","R10","R11","R12","R13","R14","R15","RIP"],known_types=["fline","help","args","label","flow","prompt","input","btext","swi","comment","fname","flag","offset","other","b0x00","b0x7f","b0xff","math","bin","push","pop","jmp","cjmp","call","nop","ret","trap","invalid","cmp","reg","creg","mov","num"],escapeHTML=function(){"use strict";var e={'"':"&quot;","&":"&amp;","<":"&lt;",">":"&gt;"};return function(r){return r?r.replace(/[\"&<>]/g,function(r){return e[r]}):""}}();Element.prototype.documentOffsetTop=function(){return this.offsetTop+(this.offsetParent?this.offsetParent.documentOffsetTop():0)};var r2={},backward=!1,next_curoff=0,next_lastoff=0,prev_curoff=0,prev_lastoff=0,hascmd=!1;r2.asyncMode="sync",r2.err=null,isFirefoxOS()?r2.root="http://cloud.radare.org":r2.root="","undefined"!=typeof module&&(module.exports=function(e){return hascmd="function"==typeof e?e:e.cmd,r2}),r2.project_name="",r2.plugin=function(){console.error("r2.plugin is not available in this environment")};try{r2plugin&&(r2.plugin=r2plugin)}catch(e){}r2.root="",r2.analAll=function(){r2.cmd("aa",function(){})},r2.analOp=function(e,r){r2.cmd("aoj 1 @ "+e,function(e){try{r(JSON.parse(e)[0])}catch(t){console.error(t),r(e)}})},r2.varMap=[],r2.argMap=[];var ajax_in_process=!1;r2.assemble=function(e,r,t){var n=e?"@"+e:"";r2.cmd('"pa '+r+'"'+n,t)},r2.disassemble=function(e,r,t){var n=e?"@"+e:"",i="pi @b:"+r+n;r2.cmd(i,t)},r2.get_hexdump=function(e,r,t){r2.cmd("px "+r+"@"+e,t)},r2.get_disasm=function(e,r,t){r2.cmd("pD "+r+"@"+e,t)},r2.get_disasm_before=function(e,r,t){var n=[];r2.cmd("pdj -"+r+"@"+e+"|",function(e){n=JSON.parse(e)}),t(n)},r2.get_disasm_after=function(e,r,t){var n=[];r2.cmd("pdj "+r+"@"+e+"|",function(e){n=JSON.parse(e)}),t(n)},r2.get_disasm_before_after=function(e,r,t,n){var i=[],o=[];r2.cmd("pdj "+r+" @"+e+"|",function(e){i=JSON.parse(e)}),r2.cmd("pdj "+t+"@"+e+"|",function(e){o=JSON.parse(e)});var a=i.concat(o);n(a)},r2.Config=function(e,r,t){return"function"!=typeof r&&r?r2.cmd("e "+e+"="+r,t):r2.cmd("e "+e+"|",t||r),r2},r2.sections={},r2.load_mmap=function(){r2.cmdj("iSj|",function(e){void 0!==e&&null!==e&&(r2.sections=e)})},r2.get_address_type=function(e){var r=parseInt(e,16);for(var t in r2.sections)if(r>=r2.sections[t].addr&&r<r2.sections[t].addr+r2.sections[t].size)return r2.sections[t].flags.indexOf("x")>-1?"instruction":"memory";return""},r2.settings={},r2.load_settings=function(){r2.cmd("e asm.arch",function(e){r2.settings["asm.arch"]=e.trim()}),r2.cmd("e asm.bits",function(e){r2.settings["asm.bits"]=e.trim()}),r2.cmd("e asm.bytes",function(e){r2.settings["asm.bytes"]=toBoolean(e.trim())}),r2.cmd("e asm.flags",function(e){r2.settings["asm.flags"]=toBoolean(e.trim())}),r2.cmd("e asm.offset",function(e){r2.settings["asm.offset"]=toBoolean(e.trim())}),r2.cmd("e asm.lines",function(e){r2.settings["asm.lines"]=toBoolean(e.trim())}),r2.cmd("e asm.xrefs",function(e){r2.settings["asm.xrefs"]=toBoolean(e.trim())}),r2.cmd("e asm.cmt.right",function(e){r2.settings["asm.cmt.right"]=toBoolean(e.trim())}),r2.cmd("e asm.pseudo",function(e){r2.settings["asm.pseudo"]=toBoolean(e.trim())})},r2.flags={},r2.update_flags=function(){r2.cmd("fs *;fj|",function(e){var r=JSON.parse(e);if(void 0!==r&&null!==r){r2.flags={};for(var t in r){var n="0x"+r[t].offset.toString(16);if(n=address_canonicalize(n),n in r2.flags){var i=r2.flags[n];i[i.length]={name:r[t].name,size:r[t].size},r2.flags[n]=i}else r2.flags[n]=[{name:r[t].name,size:r[t].size}]}}})},r2.get_flag_address=function(e){for(var r in r2.flags)for(var t in r2.flags[r])if(e==r2.flags[r][t].name)return r;return null},r2.get_flag_names=function(e){var r=[];for(var t in r2.flags[e])r[r.length]=r2.flags[e][t].name;return r},r2.set_flag_space=function(e,r){r2.cmd("fs "+e,r)},r2.get_flags=function(e){r2.cmd("fj|",function(r){e(r?JSON.parse(r):[])})},r2.get_opcodes=function(e,r,t){r2.cmd("pdj @"+e+"!"+r+"|",function(e){t(JSON.parse(e))})},r2.get_bytes=function(e,r,t){r2.cmd("pcj @"+e+"!"+r+"|",function(e){t(JSON.parse(e))})},r2.asm_config={},r2.store_asm_config=function(){config={},r2.cmd("e",function(e){conf=e.split("\n");for(var r in conf){var t=conf[r].split(" ");3==t.length&&0==t[0].trim().indexOf("asm.")&&(config[t[0].trim()]=t[2].trim())}r2.asm_config=config})},r2.restore_asm_config=function(){cmd="";for(var e in r2.asm_config)cmd+="e "+e+"="+r2.asm_config[e]+";";r2.cmd(cmd,function(){})},r2.get_info=function(e){r2.cmd("ij|",function(r){e(JSON.parse(r))})},r2.bin_relocs=function(e){r2.cmd("irj|",function(r){e(JSON.parse(r))})},r2.bin_imports=function(e){r2.cmd("iij|",function(r){e(JSON.parse(r))})},r2.bin_symbols=function(e){r2.cmd("isj|",function(r){e(JSON.parse(r))})},r2.bin_sections=function(e){r2.cmd("iSj|",function(r){e(JSON.parse(r))})},r2.cmds=function(e,r){function t(){void 0!=n&&0!=e.length&&(n=e[0],e=e.splice(1),r2.cmd(n,t),r&&r())}if(0!=e.length){var n=e[0];e=e.splice(1),r2.cmd(n,t)}},r2.cmd=function(e,r,t){if(Array.isArray(e)){var n=[],i=0;asyncLoop(e.length,function(r){_internal_cmd(e[i],function(e){i=r.iteration(),n[i]=e.replace(/\n$/,""),i++,r.next()},t)},function(){r(n)})}else _internal_cmd(e,r,t)},r2.cmdj=function(e,r){r2.cmd(e,function(e){try{r(JSON.parse(e))}catch(e){r(null)}})},r2.alive=function(e){r2.cmd("b",function(r){var t=!1;r&&r.length()>0&&(t=!0),e&&e(r)})},r2.getTextLogger=function(e){return"object"!=typeof e&&(e={}),e.last=0,e.events={},e.interval=null,r2.cmd("Tl",function(r){e.last=+r}),e.load=function(r){r2.cmd('"Tj '+(e.last+1)+'"',function(e){r&&r(JSON.parse(e))})},e.clear=function(e){r2.cmd("T-",e)},e.send=function(e,r){r2.cmd('"T '+e+'"',r)},e.refresh=function(r){e.load(function(t){for(var n=0;n<t.length;n++){var i=t[n];e.events.message({id:i[0],text:i[1]}),i[0]>e.last&&(e.last=i[0])}r&&r()})},e.autorefresh=function(r){function t(){return e.refresh(function(){}),"Logs"===r2ui.selected_panel?setTimeout(t,1e3*r):console.log("Not in logs :("),!0}return r?void(e.interval=setTimeout(t,1e3*r)):void(e.interval&&e.interval.stop())},e.on=function(r,t){return e.events[r]=t,e},e},r2.filter_asm=function(e,r){function t(e){return"p"==e[0]&&"d"==e[1]||e.indexOf(";pd")!=-1}var n=backward?prev_curoff:next_curoff,i=backward?prev_lastoff:next_lastoff,o=e.split(/\n/g);r2.cmd("s",function(e){n=e});for(var a=o.length-1;a>0;a--){var s=o[a].match(/0x([a-fA-F0-9]+)/);if(s&&s.length>0){i=s[0].replace(/:/g,"");break}}if("afl"==r){for(var c="",a=0;a<o.length;a++){var l=o[a].replace(/\ +/g," ").split(/ /g);c+=l[0]+"  "+l[3]+"\n"}e=c}else if("f"==r[0]){if("s"==r[1]){for(var c="",a=0;a<o.length;a++){var l=o[a].replace(/\ +/g," ").split(/ /g),d="*"==l[1]?"*":" ",f=l[2]?l[2]:l[1];f&&(c+=l[0]+" "+d+" <a href=\"javascript:runcmd('fs "+f+"')\">"+f+"</a>\n")}e=c}}else if("i"==r[0]&&r[1]){for(var c="",a=0;a<o.length;a++){for(var u=o[a].split(/ /g),p="",m="",_=0;_<u.length;_++){var g=u[_].split(/=/);"addr"==g[0]&&(m=g[1]),"name"==g[0]&&(p=g[1]),"string"==g[0]&&(p=g[1])}c+=m+"  "+p+"\n"}e=c}return t(r)&&(e=e.replace(/function:/g,"<span style=color:green>function:</span>"),e=e.replace(/;(\s+)/g,";"),e=e.replace(/;(.*)/g,"// <span style='color:#209020'>$1</span>"),e=e.replace(/(bl|goto|call)/g,"<b style='color:green'>call</b>"),e=e.replace(/(jmp|bne|beq|js|jnz|jae|jge|jbe|jg|je|jl|jz|jb|ja|jne)/g,"<b style='color:green'>$1</b>"),e=e.replace(/(dword|qword|word|byte|movzx|movsxd|cmovz|mov\ |lea\ )/g,"<b style='color:#1070d0'>$1</b>"),e=e.replace(/(hlt|leave|iretd|retn|ret)/g,"<b style='color:red'>$1</b>"),e=e.replace(/(add|sbb|sub|mul|div|shl|shr|and|not|xor|inc|dec|sar|sal)/g,"<b style='color:#d06010'>$1</b>"),e=e.replace(/(push|pop)/g,"<b style='color:#40a010'>$1</b>"),e=e.replace(/(test|cmp)/g,"<b style='color:#c04080'>$1</b>"),e=e.replace(/(outsd|out|string|invalid|int |int3|trap|main|in)/g,"<b style='color:red'>$1</b>"),e=e.replace(/nop/g,"<b style='color:blue'>nop</b>"),e=e.replace(/(sym|fcn|str|imp|loc)\.([^:<(\\\/ \|)\->]+)/g,"<a href='javascript:r2ui.seek(\"$1.$2\")'>$1.$2</a>")),e=e.replace(/0x([a-zA-Z0-9]+)/g,"<a href='javascript:r2ui.seek(\"0x$1\")'>0x$1</a>"),backward?(prev_curoff=n,prev_lastoff=i):(next_curoff=n,next_lastoff=i,prev_curoff||(prev_curoff=next_curoff)),e};var r2ui={};r2ui.selected_panel="Disassembler",r2ui.history=[],r2ui.history_idx=0,r2ui.colors={},r2ui.load_colors=function(){r2.cmdj("ecj",function(e){for(var r in e)r2ui.colors[".ec_"+r.replace("gui.","gui_")]="rgb("+String(e[r])+")";
});for(var e in document.styleSheets){var r=document.styleSheets[e],t=r.cssRules?r.cssRules:r.rules;for(var n in t)if(void 0!==t[n].selectorText&&null!==t[n].selectorText&&0===t[n].selectorText.toLowerCase().indexOf(".ec_")){var i=t[n].selectorText,o=r2ui.colors[i];void 0!==o&&null!==o?".ec_gui_background"==i||".ec_gui_alt_background"==i?t[n].style.backgroundColor=o:".ec_border"==i?t[n].style.borderColor=o:t[n].style.color=o:".ec_gui_background"==i||".ec_gui_alt_background"==i?r2ui.colors[i]=t[n].style.backgroundColor:".ec_gui_border"==i?r2ui.colors[i]=t[n].style.borderColor:r2ui.colors[i]=t[n].style.color}}},r2ui.basic_blocks={},r2ui.use_sdb=!1,r2ui.get_fcn_BB=function(e,r){if(r2ui.use_sdb){var t="webui/graph/"+e+"/"+r,n=void 0;return r2.cmd("k "+t,function(e){var r=decodeURIComponent(e).split("\n");for(var t in r){var i=r[t];if(""!==i){n={};var o=i.split(",");n.x=o[0],n.y=o[1],""!=o[2]&&void 0!==o[2]||(o[2]="transparent"),n.color=o[2].replace(/\*\*/g,",")}}}),n}return r2ui.basic_blocks[r]},r2ui.get_fcn_BBs=function(e){if(r2ui.use_sdb){var r="webui/graph/"+e+"/*",t={};return r2.cmd("k "+r,function(e){var r=decodeURIComponent(e).split("\n");for(var n in r){var i=r[n];if(""!==i){offset=i.split("=")[0],i=i.split("=")[1];var o={},a=i.split(",");o.x=a[0],o.y=a[1],""!=a[2]&&void 0!==a[2]||(a[2]="transparent"),o.color=a[2].replace(/\*\*/g,","),t[offset]=o}}}),t}return r2ui.basic_blocks},r2ui.update_fcn_BB=function(e,r,t){if(r2ui.use_sdb){var n="webui/graph/"+e+"/"+r;void 0===t.color&&(t.color="transparent");var i=t.x+","+t.y+","+t.color.replace(/,/g,"**");r2.cmd("k "+n+"="+encodeURIComponent(i),function(){})}else r2ui.basic_blocks[r]=t},r2ui.current_fcn_offset=null,r2ui.graph=null,r2ui.console_lang="r2",r2ui.toggle_console_lang=function(){"r2"==r2ui.console_lang?r2ui.console_lang="js":"js"==r2ui.console_lang&&(r2ui.console_lang="r2"),$("#cmd_input > label").html(r2ui.console_lang)},r2ui.history_push=function(e){e!=r2ui.history_last()&&(r2ui.history_idx!=r2ui.history.length&&(r2ui.history=r2ui.history.splice(0,r2ui.history_idx)),r2ui.history_idx++,r2ui.history.push(e))},r2ui.history_pop=function(){return r2ui.history_idx==r2ui.history.length&&r2ui.history_idx--,r2ui.history.pop()},r2ui.history_last=function(){if(r2ui.history.length>0)return r2ui.history[r2ui.history_idx-1]},r2ui.history_prev=function(){return r2ui.history_idx>1&&r2ui.history_idx--,r2ui.history[r2ui.history_idx-1]},r2ui.history_next=function(){var e=r2ui.history[r2ui.history_idx];return r2ui.history_idx<r2ui.history.length&&r2ui.history_idx++,e},r2ui.next_instruction=function(){var e=parseInt(r2ui.history_last(),16);return r2.cmd("pdl 1",function(r){e+=parseInt(r.trim())}),"0x"+e.toString(16)},r2ui.prev_instruction=function(){var e=parseInt(r2ui.history_last(),16);return r2.cmdj("pdfj",function(r){if(void 0!==r&&null!==r)for(var t in r.ops)if(0!==t){var n=r.ops[t];if(n.offset==e){e=r.ops[t-1].offset;break}}}),"0x"+e.toString(16)},r2ui.seek=function(e,r,t){if(void 0!==e){if(0===e.indexOf("0x"))e=address_canonicalize(e);else{var n=r2.get_flag_address(e);null!==n?e=address_canonicalize(n):r2.cmd("s "+e+";s|",function(r){e=address_canonicalize(r.replace("\n",""))})}r&&r2ui.history_push(e),r2.cmd("s "+e,function(){r2ui._dis.seek(e,t),r2ui._hex.seek(e,t)})}},r2ui.seek_in_graph=function(e,r){r&&r2ui.history_push(e),r2.cmd("s "+e,function(){rehighlight_iaddress(e),r2ui._hex.seek(e),r2ui._hex.scrollTo(0,0)})},r2ui.seek_prev=function(){var e=r2ui.history.pop();r2.cmd("s "+e,function(){r2ui._dis.seek(e),r2ui._dis.scrollTo(0,0),r2ui._hex.seek(e),r2ui._hex.scrollTo(0,0)})},r2ui.openpage=function(e,r){void 0===r&&(r=e,e=void 0),void 0!==e&&r2ui.seek(e,!0),2==r2ui.ra.getIndex()&&r2ui.ra.setIndex(1),r2ui.mp.openPage(r)},r2ui.opendis=function(e){r2ui.openpage(e,0)},r2ui.openhex=function(e){r2ui.openpage(e,2)};
