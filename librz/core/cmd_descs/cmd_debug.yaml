# SPDX-FileCopyrightText: 2021 RizinOrg <info@rizin.re>
# SPDX-License-Identifier: LGPL-3.0-only
---
name: cmd_debug
commands:
  - name: dc
    cname: debug_continue_oldhandler
    summary: Continue execution
    type: RZ_CMD_DESC_TYPE_OLDINPUT
  - name: ds
    summary: Debug step commands
    cname: cmd_debug_step
    type: RZ_CMD_DESC_TYPE_OLDINPUT
    subcommands:
      - name: dsu
        summary: Debug step until commands
        subcommands:
          - name: dsu
            cname: cmd_debug_step_until
            summary: Step until <addr>
            args:
              - name: addr
                type: RZ_CMD_ARG_TYPE_RZNUM
          - name: dsui
            cname: cmd_debug_step_until_instr
            summary: Step until an instruction that matches <instr>
            args:
              - name: instr
                type: RZ_CMD_ARG_TYPE_STRING
          - name: dsuir
            cname: cmd_debug_step_until_instr_regex
            summary: Step until an instruction that matches <regex>
            args:
              - name: regex
                type: RZ_CMD_ARG_TYPE_STRING
          - name: dsuo
            cname: cmd_debug_step_until_optype
            summary: Step until an instruction matches one of the <optype>s
            args:
              - name: optype
                type: RZ_CMD_ARG_TYPE_STRING
                flags: RZ_CMD_ARG_FLAG_ARRAY
          - name: dsue
            cname: cmd_debug_step_until_esil
            summary: Step until <esil> expression matches
            args:
              - name: esil
                type: RZ_CMD_ARG_TYPE_STRING
          - name: dsuf
            cname: cmd_debug_step_until_flag
            summary: Step until pc == <flag> matching name
            args:
              - name: flag
                type: RZ_CMD_ARG_TYPE_FLAG
  - name: dts
    summary: Debug trace session commands
    subcommands:
      - name: dts+
        summary: Start trace session
        cname: cmd_debug_start_trace_session
        args: []
      - name: dts-
        summary: Stop trace session
        cname: cmd_debug_stop_trace_session
        args: []
      - name: dtst
        cname: cmd_debug_save_trace_session
        summary: Save trace sessions to disk
        args:
          - name: dir
            type: RZ_CMD_ARG_TYPE_FILE
      - name: dtsf
        cname: cmd_debug_load_trace_session
        summary: Load trace sessions to disk
        args:
          - name: dir
            type: RZ_CMD_ARG_TYPE_FILE
      - name: dtsm
        cname: cmd_debug_list_trace_session_mmap
        summary: List current memory map and hash
        args: []
  - name: dm
    summary: Memory map commands
    subcommands:
      - name: dm
        cname: cmd_debug_list_maps
        summary: >
          List memory maps / Allocate <size> bytes at <address>
          (anywhere if address is -1)
        modes:
          - RZ_OUTPUT_MODE_STANDARD
          - RZ_OUTPUT_MODE_RIZIN
          - RZ_OUTPUT_MODE_JSON
        args:
          - name: address
            type: RZ_CMD_ARG_TYPE_RZNUM
            optional: true
          - name: size
            type: RZ_CMD_ARG_TYPE_RZNUM
            optional: true
      - name: dm=
        cname: cmd_debug_list_maps_ascii
        summary: List memory maps of current process with ASCII art bars
        args: []
      - name: dm.
        cname: cmd_debug_map_current
        summary: Show map name of current address
        args: []
      - name: dmm
        summary: Module memory map commands
        subcommands:
          - name: dmm
            summary: List modules of target process
            cname: cmd_debug_modules
            modes:
              - RZ_OUTPUT_MODE_STANDARD
              - RZ_OUTPUT_MODE_RIZIN
              - RZ_OUTPUT_MODE_JSON
            args: []
          - name: dmm.
            cname: cmd_debug_current_modules
            summary: List memory map of current module
            args: []
      - name: dm-
        summary: Deallocate memory map of <address>
        cname: cmd_debug_deallocate_map
        args:
          - name: address
            type: RZ_CMD_ARG_TYPE_RZNUM
            optional: false
      - name: dmd
        summary: Dump debug map regions to a file (from-to.dmp)
        subcommands:
          - name: dmd
            summary: Dump debug maps to <filename>
            cname: cmd_debug_dump_maps
            args:
              - name: filename
                type: RZ_CMD_ARG_TYPE_FILE
                optional: true
          - name: dmda
            cname: cmd_debug_dump_maps_all
            summary: Dump all debug maps
            args: []
          - name: dmdw
            cname: cmd_debug_dump_maps_writable
            summary: Dump writable debug maps
            args: []
      - name: dmh
        summary: Show map of heap
        cname: cmd_debug_heap
        type: RZ_CMD_DESC_TYPE_OLDINPUT
        args: []
      - name: dmi
        summary: List/Load symbols
        cname: cmd_debug_dmi
        type: RZ_CMD_DESC_TYPE_OLDINPUT
      - name: dml
        summary: Load contents of file into current map region
        cname: cmd_debug_dml
        args:
          - name: file
            type: RZ_CMD_ARG_TYPE_FILE
            optional: false
      - name: dmp
        summary: >
          Change page at <address> with <size>, protection <perms>
          / Change dbg.map permissions to <perm>
        cname: cmd_debug_dmp
        args:
          - name: addr
            type: RZ_CMD_ARG_TYPE_NUM
            optional: true
          - name: size
            type: RZ_CMD_ARG_TYPE_NUM
            optional: true
          - name: perms
            type: RZ_CMD_ARG_TYPE_STRING
            optional: false
      - name: dmL
        summary: Allocate <size> bytes at <address> and promote to huge page
        cname: cmd_debug_dmL
        args:
          - name: addr
            type: RZ_CMD_ARG_TYPE_NUM
          - name: size
            type: RZ_CMD_ARG_TYPE_NUM
      - name: dmS
        summary: List sections of target lib
        cname: cmd_debug_dmS
        type: RZ_CMD_DESC_TYPE_OLDINPUT
        args:
          - name: addr|libname
            type: RZ_CMD_ARG_TYPE_STRING
            optional: true
          - name: sectname
            type: RZ_CMD_ARG_TYPE_STRING
            optional: true
