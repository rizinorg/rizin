NAME="dwarf: lines"
FILE=bins/elf/ada_test_dwarf
CMDS=<<EOF
aaa
e asm.dwarf=true
e asm.dwarf.lines=true
s main
pdf
e asm.dwarf.lines=false
pdf
EOF
EXPECT=<<EOF
            ; DATA XREF from entry0 @ 0x2271
            ;-- main:
/ int dbg.main (int argc, char **argv, char **envp);
|           ; arg int argc @ rdi
|           ; arg char **argv @ rsi
|           ; arg char **envp @ rdx
|           ; var char **var_30h @ stack - 0x30
|           ; var char **var_28h @ stack - 0x28
|           ; var int var_1ch @ stack - 0x1c
|           ; var system__address ensure_reference @ stack - 0x18
|           ; var struct ada_main__main__seh___PAD seh @ stack - 0x10
|           0x00002742      push  rbp                                                                                                                                                  ; ada_test_dwarf:207                    ; b~ada_test.adb:207 ; integer main(const integer argc,void * const  argv,void * const  envp);
|           0x00002743      mov   rbp, rsp                                                                                                                                                               
|           0x00002746      sub   rsp, 0x30                                                                                                                                                              
|           0x0000274a      mov   dword [var_1ch], edi                                                                                                                                                    ; argc
|           0x0000274d      mov   qword [var_28h], rsi                                                                                                                                                    ; argv
|           0x00002751      mov   qword [var_30h], rdx                                                                                                                                                    ; envp
|           0x00002755      lea   rax, obj.__gnat_ada_main_program_name                                                                                                                  ; ada_test_dwarf:220                   ; b~ada_test.adb:220 ; 0x3038 ; "_ada_ada_test"
|           0x0000275c      mov   qword [ensure_reference], rax                                                                                                                                          
|           0x00002760      mov   eax, dword [var_1ch]                                                                                                                                   ; ada_test_dwarf:224                  ; b~ada_test.adb:224
|           0x00002763      mov   dword [obj.gnat_argc], eax                                                                                                                                              ; [0x51c0:4]=0
|           0x00002769      mov   rax, qword [var_28h]                                                                                                                                    ; ada_test_dwarf:225                 ; b~ada_test.adb:225
|           0x0000276d      mov   qword [obj.gnat_argv], rax                                                                                                                                              ; [0x5128:8]=0
|           0x00002774      mov   rax, qword [var_30h]                                                                                                                                     ; ada_test_dwarf:226                ; b~ada_test.adb:226
|           0x00002778      mov   qword [obj.gnat_envp], rax                                                                                                                                              ; [0x5090:8]=0
|           0x0000277f      lea   rax, [seh.F]                                                                                                                                              ; ada_test_dwarf:228               ; b~ada_test.adb:228
|           0x00002783      mov   rdi, rax                                                                                                                                                               
|           0x00002786      call  sym.imp.__gnat_initialize                                                                                                                                              
|           0x0000278b      call  dbg.adainit                                                                                                                                                ; ada_test_dwarf:229              ; b~ada_test.adb:229
|           0x00002790      call  dbg._ada_ada_test                                                                                                                                           ; ada_test_dwarf:230             ; b~ada_test.adb:230
|           0x00002795      call  dbg.adafinal                                                                                                                                                 ; ada_test_dwarf:231            ; b~ada_test.adb:231
|           0x0000279a      call  sym.imp.__gnat_finalize                                                                                                                                       ; ada_test_dwarf:232           ; b~ada_test.adb:232
|           0x0000279f      mov   eax, dword [obj.gnat_exit_status]                                                                                                                              ; ada_test_dwarf:233          ; b~ada_test.adb:233 ; [0x50f0:4]=0
|           0x000027a5      leave                                                                                                                                                                 ; ada_test_dwarf:234         ; b~ada_test.adb:234
\           0x000027a6      ret                                                                                                                                                                          
            ; DATA XREF from entry0 @ 0x2271
            ;-- main:
/ int dbg.main (int argc, char **argv, char **envp);
|           ; arg int argc @ rdi
|           ; arg char **argv @ rsi
|           ; arg char **envp @ rdx
|           ; var char **var_30h @ stack - 0x30
|           ; var char **var_28h @ stack - 0x28
|           ; var int var_1ch @ stack - 0x1c
|           ; var system__address ensure_reference @ stack - 0x18
|           ; var struct ada_main__main__seh___PAD seh @ stack - 0x10
|           0x00002742      push  rbp                                  ; b~ada_test.adb:207 ; integer main(const integer argc,void * const  argv,void * const  envp);
|           0x00002743      mov   rbp, rsp
|           0x00002746      sub   rsp, 0x30
|           0x0000274a      mov   dword [var_1ch], edi                 ; argc
|           0x0000274d      mov   qword [var_28h], rsi                 ; argv
|           0x00002751      mov   qword [var_30h], rdx                 ; envp
|           0x00002755      lea   rax, obj.__gnat_ada_main_program_name ; b~ada_test.adb:220 ; 0x3038 ; "_ada_ada_test"
|           0x0000275c      mov   qword [ensure_reference], rax
|           0x00002760      mov   eax, dword [var_1ch]                 ; b~ada_test.adb:224
|           0x00002763      mov   dword [obj.gnat_argc], eax           ; [0x51c0:4]=0
|           0x00002769      mov   rax, qword [var_28h]                 ; b~ada_test.adb:225
|           0x0000276d      mov   qword [obj.gnat_argv], rax           ; [0x5128:8]=0
|           0x00002774      mov   rax, qword [var_30h]                 ; b~ada_test.adb:226
|           0x00002778      mov   qword [obj.gnat_envp], rax           ; [0x5090:8]=0
|           0x0000277f      lea   rax, [seh.F]                         ; b~ada_test.adb:228
|           0x00002783      mov   rdi, rax
|           0x00002786      call  sym.imp.__gnat_initialize
|           0x0000278b      call  dbg.adainit                          ; b~ada_test.adb:229
|           0x00002790      call  dbg._ada_ada_test                    ; b~ada_test.adb:230
|           0x00002795      call  dbg.adafinal                         ; b~ada_test.adb:231
|           0x0000279a      call  sym.imp.__gnat_finalize              ; b~ada_test.adb:232
|           0x0000279f      mov   eax, dword [obj.gnat_exit_status]    ; b~ada_test.adb:233 ; [0x50f0:4]=0
|           0x000027a5      leave                                      ; b~ada_test.adb:234
\           0x000027a6      ret
EOF
RUN
